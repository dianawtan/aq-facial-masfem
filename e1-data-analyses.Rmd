---
title: "Data Analyses for Experiment 1"
output: html_document
---

## Notes

This markdown document contains the analyses associated with the results and figures reported in Experiment 1 of the paper which examined original photographs of males and females with low, mid-range, or high levels of autistic traits.


### Install (if necessary) and load packages
```{r setup, echo=FALSE, message=FALSE, warning=TRUE}
## install and load required packages

pkgToAttach <- 
  c("tidyverse",  # dplyr, readr, etc.
    "lmerTest",  # linear mixed effects
    "ggplot2",  # plots
    "psych",  # reliability analyses
    "here",  # relative paths
    "ggpubr"
    )

invisible(lapply(pkgToAttach, function (pkg) {
  if (!pkg %in% installed.packages()) {  # if package is not installed, install & attach it
    cat("Required package", pkg, "missing. Attempting to install now.\n\n")
    install.packages(pkg, dependencies = TRUE, quiet = TRUE)
    cat("Package installed:", pkg, "\n")
  }
  
  library(pkg, character.only = TRUE, quiet = TRUE)
  cat("Package attached:", pkg, "\n")
  
}))

rm(pkgToAttach)  # clean up
```


### Importing Data
```{r data-import, echo=FALSE, message=FALSE, warning=TRUE}
## LAQ = 1, MAQ = 2, HAQ = 3

## import data
dataMorg <- read_csv(here("Data","e1_masRatings.csv"))  # for male original faces
dataForg <- read_csv(here("Data","e1_femRatings.csv"))  # for female original faces

```
There are a total of `r nrow(dataMorg)` male faces and `r nrow(dataForg)` female faces.


### Reliability Analyses and Data Cleaning
```{r reliability-analyses, echo=FALSE, message=FALSE, warning=TRUE}
## item-rest correlation analyses to identify raters with inconsistent ratings using r < .20 as cut-off. 

## female faces
femorg <- select(dataForg, starts_with("Rater"))  # select rater scores
cat("ICC2k average random raters for FEMALE FACES:")
ICC(femorg)$results %>%   # reported ICC2k average random raters
  filter(., type == "ICC2k")

# calc alpha and remove raters with item-rest correlation r < .20
alphaFem <- alpha(femorg)

femRatersToRemove  <- 
  alphaFem[["item.stats"]] %>% 
  rownames_to_column(., var = "Rater") %>% 
  filter(., r.cor < .20) %>%
  pull(., Rater)

dataForgCleaned <-
  select(dataForg, -one_of(femRatersToRemove))


## male faces
masorg <- select(dataMorg, starts_with("Rater"))  # select rater scores
cat("ICC2k average random raters for MALE FACES:")
ICC(masorg)$results %>%   # reported ICC2k average random raters
  filter(., type == "ICC2k")

# calc alpha and remove those with item-rest correlation r < .20
alphaMas <- alpha(masorg)

masRatersToRemove  <- 
  alphaMas[["item.stats"]] %>% 
  rownames_to_column(., var = "Rater") %>% 
  filter(., r.cor < .20) %>%
  pull(., Rater)

dataMorgCleaned <-
  select(dataMorg, -one_of(masRatersToRemove))

rm(alphaFem, alphaMas, femorg, masorg, dataForg, dataMorg)  # clean up
```
Raters are removed from further analyses if their item-rest correlation was < .20.

`r length(femRatersToRemove)` raters (female faces) and `r length(masRatersToRemove)` raters (male faces) were removed.


### LME Analyses
```{r data-reshape-lme, echo=FALSE, message=FALSE, warning=TRUE, include=FALSE}
## convert data frame into long format for LME

dataMorg_long <- gather(dataMorgCleaned, "RaterID", "mascRating", 8:48)
dataForg_long <- gather(dataForgCleaned, "RaterID", "femRating", 8:48)

```


```{r LME models: AQ scores and masculinity/femininity ratings, echo=FALSE, message=FALSE, warning=TRUE, include=FALSE}
## female stimuli
## AQ as predictor and femininity ratings as outcome

# LME: random intercept only (linear AQ term)
femorg_lme1 <- lmer(femRating ~ aqScore + (1|RaterID), REML = FALSE, data = dataForg_long)
summary(femorg_lme1) 

## male stimuli
## AQ as predictor and femininity ratings as outcome

# LME: random intercept only (linear AQ term)
mascorg_lme1 <- lmer(mascRating ~ aqScore + (1|RaterID), REML = FALSE, data = dataMorg_long)
summary(mascorg_lme1)

# LME: random intercept only (linear + quadratic AQ term)
dataMorg_long$aqScoreSq <- (dataMorg_long$aqScore)^2 # create squared AQ

mascorg_lme2 <- lmer(mascRating ~ aqScore + aqScoreSq + (1|RaterID), REML = FALSE, data = dataMorg_long)
summary(mascorg_lme2)

```


```{r linear regression: AQ scores and morphological masculinity scores, echo=FALSE, message=FALSE, warning=TRUE, include=FALSE}
## female stimuli
## AQ as predictor and morphological masculinity score (zfaceMasc) as outcome

femobj_regr <- lm(zfaceMasc ~ aqScore, data = dataForgCleaned)
summary(femobj_regr)

## male stimuli
## AQ as predictor and morphological masculinity score (zfaceMasc) as outcome

masobj_regr <- lm(zfaceMasc ~ aqScore,data = dataMorgCleaned)
summary(masobj_regr)

```


```{r linear regression: Masculinity/femininity ratings and morphological masculinity scores, echo=FALSE, message=FALSE, warning=TRUE, include=FALSE}

## female stimuli
## morphological masculinity scores (zfaceMasc) as predictor and femininity ratings as outcome

femobjsubj_regr <- lm(aveRating ~ zfaceMasc, data = dataForgCleaned)
summary(femobjsubj_regr)

## male stimuli
## morphological masculinity scores (zfaceMasc) as predictor and masculinity ratings as outcome

masobjsubj_regr <- lm(aveRating ~ zfaceMasc, data = dataMorgCleaned)
summary(masobjsubj_regr)
```


```{r figures, echo=FALSE, message=FALSE, warning=TRUE, include=FALSE}

## Figure 2 left panel (femininity ratings)
femorgplot <- ggplot(data = dataForg_long, aes(x = aqScore, y = femRating)) + 
  geom_point(aes(group = RaterID), size = 1, alpha = 0.4) +
  geom_smooth(method = "lm", size = 1, colour = 'red', fill = 'red', alpha = 0.3) +
  stat_summary(fun.y = mean, geom="point", shape = 21, size = 2.5, stroke = 1.2, colour = 'black', fill = 'blue') + 
  labs(x = "AQ Scores", y = "Femininity Ratings") +
  ylim(0,10) +
  xlim(1,45)

print(femorgplot)

## Figure 2 right panel (masculinity ratings)
masorgplot <- ggplot(data = dataMorg_long, aes(x = aqScore, y = mascRating)) + 
  geom_point(aes(group = RaterID), size = 1, alpha = 0.4) +
  stat_smooth(method = "lm", formula = y ~ x + I(x^2), size = 1, colour = 'red', fill = 'red', alpha = 0.3) +
  stat_summary(fun.y = mean, geom="point", shape = 21, size = 2.5, stroke = 1.2, colour = 'black', fill = 'blue') + 
  labs(x = "AQ Scores", y = "Masculinity Ratings") +
  ylim(0,10) +
  xlim(1,45)

print(masorgplot)

fig2 <- ggpubr::ggarrange(femorgplot, masorgplot)
print(fig2)

## Save Figure 2
ggsave("Fig2.jpeg", 
       fig2, 
       dpi = 300,
       units = "in",
       width = 6.57,
       height = 3.67)

## Figure 3 left panel (MMS for females)
femscoreplot <- ggplot(data = dataForgCleaned, aes(x = aqScore, y = zfaceMasc)) +
  geom_point(size = 1.5, alpha = 0.3) +
  geom_smooth(method = "lm", size = 1, colour = 'red', fill = 'red', alpha = 0.3) +
  labs(x = "AQ Scores", y = "Morphological Masculinity Scores", title = "Females") +
  ylim(-3,3) +
  xlim(1,45)

print(femscoreplot)

## Figure 3 right panel (MMS for males)
mascscoreplot <- ggplot(data = dataMorgCleaned, aes(x = aqScore, y = zfaceMasc)) +
  geom_point(size = 1.5, alpha = 0.3) +
  geom_smooth(method = "lm", size = 1, colour = 'red', fill = 'red', alpha = 0.3) +
  labs(x = "AQ Scores", y = "Morphological Masculinity Scores", title = "Males") +
  ylim(-3,3)+
  xlim(1,45)

print(mascscoreplot)

fig3 <- ggpubr::ggarrange(femscoreplot, mascscoreplot)
print(fig3)

## Save Figure 3
ggsave("Fig3.jpeg", 
       fig3, 
       dpi = 300,
       units = "in",
       width = 6.57,
       height = 3.67)

```

