---
title: "01. Data wrangling"
author: "Diana Tan"
date: "8/12/2019"
output: html_document
---

```{r setup, include = FALSE}
library(tidyverse)
library(dplyr)
library(here)
library(lmerTest)
library(ggplot2)
```

```{r data import, include = FALSE}
## LAQ = 1, MAQ = 2, HAQ = 3

dataMorg <- read.csv(here("Data","e1_mascRatings.csv")) 
dataForg <- read.csv(here("Data","e1_femRatings.csv")) %>%
  rename(StimPpt = ï..StimPpt)

dataMcom <- read.csv(here("Data", "e2_mascRatings.csv")) %>%
  rename(stimulus = ï..Stimulus)
dataFcom <- read.csv(here("Data", "e2_femRatings.csv")) %>%
  rename(stimulus = ï..Stimulus)

```

```{r data wrangling}
##convert data into long format for LME

dataMorg_long <- gather(dataMorg, "RaterID", "mascRating", 7:47)
dataForg_long <- gather(dataForg, "RaterID", "femRating", 7:47)

dataMcom_long <- gather(dataMcom, "RaterID", "mascRating", 4:39)
dataFcom_long <- gather(dataFcom, "RaterID", "femRating", 4:39)

```

```{r LME models}
##### original faces #####
## femininity scores ##

# linear regression
femorg_regr <- lm(aveRating ~ Aqscore, data = dataForg)
summary(femorg_regr)

# LME: random intercept only
femorg_lme1 <- lmer(femRating ~ Aqscore + (1|RaterID), REML = FALSE, data = dataForg_long)
summary(femorg_lme1) 

# LME: random intercept and slope
# singular fit, model is overfitted

## masculinity scores ##

# linear regression
mascorg_regr <- lm(aveRating ~ Aqscore, data = dataMorg)
summary(mascorg_regr)

# LME: random intercept only (linear AQ term)
mascorg_lme1 <- lmer(mascRating ~ Aqscore + (1|RaterID), REML = FALSE, data = dataMorg_long)
summary(mascorg_lme1)

# LME: random intercept only (linear + quadratic AQ term) -- justify adding quadratic term
dataMorg_long$polyAqscore <- (dataMorg_long$Aqscore)^2

mascorg_lme2 <- lmer(mascRating ~ Aqscore + polyAqscore + (1|RaterID), REML = FALSE, data = dataMorg_long)
summary(mascorg_lme2)

# random intercept and slope
# singular fit, model over fit

#visualisation
femorgplot <- ggplot(dataForg_long, aes(x = Aqscore, y= femRating)) + 
  geom_point() +
  geom_line(aes(y = predict(femorg_lme1), group = RaterID)) 

print(femorgplot)

mascorgplot <- ggplot(dataMorg_long, aes(x = Aqscore, y= mascRating)) + 
  geom_point() +
  geom_line(aes(y = predict(mascorg_lme2), group = RaterID)) 

print(mascorgplot)

##### composite faces #####
## femininity scores ##

# linear regression
femcom_regr <- lm(femRating ~ meanAQscore, data = dataFcom_long)
summary(femcom_regr)

# LME: random intercept only (linear term only)
femcom_lme1 <- lmer(femRating ~ meanAQscore + (1|RaterID), REML = FALSE, data = dataFcom_long)
summary(femcom_lme1) 

# LME: random intercept only (linear + quadratic terms)
dataFcom_long$polyAqscore <- (dataFcom_long$meanAQscore)^2
femcom_lme2 <- lmer(femRating ~ meanAQscore + polyAqscore + (1|RaterID), REML = FALSE, data = dataFcom_long)
summary(femcom_lme2) 

# LME: random intercept and slope
# singular fit, model is overfitted

## masculinity scores ##

# linear regression
masccom_regr <- lm(mascRating ~ meanAQscore, data = dataMcom_long)
summary(masccom_regr)

# LME: random intercept only (linear AQ term)
masccom_lme1 <- lmer(mascRating ~ meanAQscore + (1|RaterID), REML = FALSE, data = dataMcom_long)
summary(masccom_lme1)

# LME: random intercept only (linear + quadratic AQ term)
dataMcom_long$polyAqscore <- (dataMcom_long$meanAQscore)^2

masccom_lme2 <- lmer(mascRating ~ meanAQscore + polyAqscore + (1|RaterID), REML = FALSE, data = dataMcom_long)
summary(masccom_lme2)

# random intercept and slope
# singular fit, model over fit

#visualisation
femcomplot <- ggplot(dataFcom_long, aes(x = meanAQscore, y= femRating)) + 
  geom_point() +
  geom_line(aes(y = predict(femcom_lme1), group = RaterID)) 

print(femcomplot)

femcomplot2 <- ggplot(dataFcom_long, aes(x = meanAQscore, y= femRating)) + 
  geom_point() +
  geom_line(aes(y = predict(femcom_lme2), group = RaterID)) 

print(femcomplot2)

masccomplot <- ggplot(dataMcom_long, aes(x = meanAQscore, y= mascRating)) + 
  geom_point() +
  geom_line(aes(y = predict(masccom_lme2), group = RaterID)) 

print(masccomplot)

```

```{r objective measurements}
masobj_regr <- lm(faceMasc ~ Aqscore,data = dataMorg)
summary(masobj_regr)
cor.test(dataMorg$Aqscore, dataMorg$faceMasc)

femobj_regr <- lm(faceMasc ~ Aqscore, data = dataForg)
summary(femobj_regr)
cor.test(dataForg$Aqscore, dataForg$faceMasc)

cor.test(dataMorg$faceMasc, dataMorg$aveRating)
cor.test(dataForg$faceMasc, dataForg$aveRating)

dataMorg$quad_aveRating <- dataMorg$aveRating^2
cor.test(dataMorg)

```
